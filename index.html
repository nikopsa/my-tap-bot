<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org"></script>
    <!-- –ü–û–î–ö–õ–Æ–ß–ê–ï–ú –°–ö–†–ò–ü–¢ –†–ï–ö–õ–ê–ú–´ -->
    <script src="https://sad.adsgram.ai"></script>
    <style>
        body { background: #000; color: gold; text-align: center; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; justify-content: space-between; margin: 0; overflow: hidden; }
        .row { display: flex; justify-content: space-around; padding: 15px; }
        #score { font-size: 50px; font-weight: bold; text-shadow: 0 0 10px gold; }
        .coin { width: 220px; height: 220px; background: orange; border-radius: 50%; border: 8px solid gold; font-size: 80px; display: flex; justify-content: center; align-items: center; margin: auto; cursor: pointer; transition: transform 0.05s; position: relative; }
        .coin:active { transform: scale(0.95); }
        .btn { padding: 12px; background: #111; border: 1px solid gold; color: gold; border-radius: 12px; width: 45%; font-weight: bold; cursor: pointer; }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; padding: 20px; overflow-y: auto; }
        .plus { position: absolute; color: white; font-size: 30px; animation: up 0.6s forwards; pointer-events: none; }
        #energy-bar { width: 80%; height: 10px; background: #333; margin: 5px auto; border-radius: 5px; overflow: hidden; }
        #energy-fill { width: 100%; height: 100%; background: lime; transition: width 0.3s; }
        #league { font-weight: bold; color: white; margin-bottom: 5px; font-size: 18px; }
        .ad-btn { background: #f39c12; color: #000; border: none; margin-top: 10px; width: 100%; padding: 10px; border-radius: 10px; font-weight: bold; }
        @keyframes up { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>
    <div class="row"><div class="btn" onclick="showT()">üèÜ –¢–û–ü</div><div class="btn" onclick="showR()">üë• –î–†–£–ó–¨–Ø</div></div>
    <div>
        <div id="league">–ë–†–û–ù–ó–ê</div>
        <div id="score">0</div>
        <div id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div id="energy-bar"><div id="energy-fill"></div></div>
        <div id="energy-text">‚ö° 2500 / 2500</div>
    </div>
    <div class="coin" id="coin">üî•</div>
    <div class="row"><div class="btn" onclick="showS()">üõí –ú–ê–ì–ê–ó–ò–ù</div><div class="btn" onclick="buyA()">‚öôÔ∏è –ú–ê–ô–ù–ï–†</div></div>
    <div id="modal"><h2 id="mt"></h2><br><div id="ml"></div><br><div class="btn" style="width:100%" onclick="closeM()">–ó–ê–ö–†–´–¢–¨</div></div>

    <script>
        let tg = window.Telegram.WebApp; tg.expand();
        let id = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 123;
        let score = 0, mult = 1, auto = 0, energy = 2500, maxEnergy = 2500;

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –†–ï–ö–õ–ê–ú–´ (–ó–∞–º–µ–Ω–∏ –¢–í–û–ô_BLOCK_ID)
        const AdController = window.Adsgram.init({ blockId: "–¢–í–û–ô_BLOCK_ID" });

        function getLeague(s) {
            if (s >= 100000) return "üî• –§–ï–ù–ò–ö–°";
            if (s >= 25000) return "üü° –ó–û–õ–û–¢–û";
            if (s >= 5000) return "‚ö™ –°–ï–†–ï–ë–†–û";
            return "ü•â –ë–†–û–ù–ó–ê";
        }

        function draw() { 
            document.getElementById('score').innerText = Math.floor(score); 
            document.getElementById('league').innerText = getLeague(score);
            document.getElementById('status').innerText = `–ö–ª–∏–∫: +${mult} | –ê–≤—Ç–æ: ${auto}/—Å`;
            let proc = (energy / maxEnergy) * 100;
            document.getElementById('energy-fill').style.width = proc + "%";
            document.getElementById('energy-text').innerText = `‚ö° ${Math.floor(energy)} / ${maxEnergy}`;
        }

        fetch('/u/' + id).then(r => r.json()).then(d => { 
            score = d.score; mult = d.mult; auto = d.auto; 
            energy = d.energy; maxEnergy = d.max_energy;
            draw(); 
        });

        setInterval(() => { if(auto > 0) { score += auto; draw(); if(Math.random() > 0.8) save(); } }, 1000);

        document.getElementById('coin').onclick = (e) => {
            if (energy >= mult) {
                energy -= mult; score += mult; draw();
                let p = document.createElement('div'); p.className = 'plus'; p.innerText = '+' + mult;
                p.style.left = e.pageX + 'px'; p.style.top = e.pageY + 'px';
                document.body.appendChild(p); setTimeout(() => p.remove(), 600);
                if(score % 10 === 0) save();
            } else {
                tg.HapticFeedback.notificationOccurred('error');
            }
        };

        function save() { 
            fetch('/s', { 
                method: 'POST', 
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({id: id, score: Math.floor(score), mult: mult, auto: auto, energy: Math.floor(energy), max_energy: maxEnergy}) 
            }); 
        }

        // –§–£–ù–ö–¶–ò–Ø –ü–†–û–°–ú–û–¢–†–ê –†–ï–ö–õ–ê–ú–´
        async function showAd() {
            try {
                const result = await AdController.show();
                if (result.done) {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ç–≤–æ–π Python —Å–µ—Ä–≤–µ—Ä –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –º–æ–Ω–µ—Ç
                    const res = await fetch('/reward_ad', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ id: id })
                    });
                    const data = await res.json();
                    score = data.new_balance;
                    draw();
                    tg.showAlert("üí∞ –ù–∞–≥—Ä–∞–¥–∞ 5000 –º–æ–Ω–µ—Ç –ø–æ–ª—É—á–µ–Ω–∞!");
                }
            } catch (e) {
                tg.showAlert("–†–µ–∫–ª–∞–º–∞ –ø–æ–∫–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.");
            }
        }

        function buyWithStars(item) {
            fetch(`/create_invoice/${id}/${item}`).then(r => r.json()).then(d => {
                tg.openInvoice(d.link, (status) => {
                    if(status === 'paid') { tg.showAlert("–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞!"); location.reload(); }
                });
            });
        }

        function showS() { 
            openM("üõí –ú–ê–ì–ê–ó–ò–ù", 
                `<button class="ad-btn" onclick="showAd()">üì∫ –°–ú–û–¢–†–ï–¢–¨ –†–ï–ö–õ–ê–ú–£ (+5000 ü™ô)</button><hr>` +
                `‚≠ê –ö–ª–∏–∫ +1: 50 –ó–≤–µ–∑–¥ <button onclick="buyWithStars('mult')">–ö–£–ü–ò–¢–¨</button><br><br>` +
                `‚≠ê –ë–∞–∫ +500: 100 –ó–≤–µ–∑–¥ <button onclick="buyWithStars('energy')">–ö–£–ü–ò–¢–¨</button><br><br>` +
                `ü™ô –ú–∞–π–Ω–µ—Ä: ${(auto+1)*500} ü™ô <button onclick="buyA()">–ö–£–ü–ò–¢–¨</button>`
            ); 
        }

        function buyA() { let c = (auto + 1) * 500; if(score >= c) { score -= c; auto++; save(); draw(); } }
        
        function showT() { 
            fetch('/top').then(r => r.json()).then(d => { 
                openM("–¢–û–ü", d.map((l, i) => `${i+1}. ${l.id}: ${l.s}`).join('<br>')); 
            }); 
        }

        function showR() { 
            let link = `https://t.me{id}`;
            openM("üë• –î–†–£–ó–¨–Ø", `–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π (+2500 ü™ô)<br><br><small>${link}</small>`); 
        }

        function openM(t, h) { document.getElementById('mt').innerText = t; document.getElementById('ml').innerHTML = h; document.getElementById('modal').style.display = 'block'; }
        function closeM() { document.getElementById('modal').style.display = 'none'; }
    </script>
</body>
</html>
