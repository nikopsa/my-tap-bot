<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://telegram.org"></script>
    <style>
        body { background: #000; color: gold; text-align: center; font-family: sans-serif; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .coin { width: 200px; height: 200px; background: orange; border-radius: 50%; border: 10px solid gold; font-size: 80px; display: flex; justify-content: center; align-items: center; cursor: pointer; user-select: none; transition: transform 0.1s; }
        .coin:active { transform: scale(0.9); }
        #score { font-size: 50px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div id="score">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div class="coin" onclick="tap()">üî•</div>

    <script>
        let tg = window.Telegram.WebApp;
        let userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 12345;
        let count = 0;

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—á–µ—Ç –∏–∑ –±–∞–∑—ã –ø—Ä–∏ –≤—Ö–æ–¥–µ
        fetch(`/get_user/${userId}`)
            .then(res => res.json())
            .then(data => {
                count = data.score;
                document.getElementById('score').innerText = count;
            });

        function tap() {
            count++;
            document.getElementById('score').innerText = count;
            tg.HapticFeedback.impactOccurred('medium');

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—á–µ—Ç –≤ –±–∞–∑—É (–∫–∞–∂–¥—ã–µ 5 –∫–ª–∏–∫–æ–≤ –∏–ª–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏)
            if (count % 5 === 0) { saveScore(); }
        }

        function saveScore() {
            fetch('/update_score', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({user_id: userId, score: count})
            });
        }
        
        tg.onEvent('viewportChanged', saveScore); // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
    </script>
</body>
</html>
