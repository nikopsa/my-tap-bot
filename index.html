<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org"></script>
    <style>
        body { background: radial-gradient(circle, #2c3e50, #000); color: gold; text-align: center; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; justify-content: space-between; margin: 0; overflow: hidden; user-select: none; }
        .row { display: flex; justify-content: space-around; padding: 15px; }
        #score { font-size: 55px; font-weight: bold; text-shadow: 0 0 15px gold; }
        .coin { width: 230px; height: 230px; background: orange; border-radius: 50%; border: 8px solid gold; font-size: 90px; display: flex; justify-content: center; align-items: center; margin: auto; box-shadow: 0 0 30px orange; cursor: pointer; transition: transform 0.05s; }
        .coin:active { transform: scale(0.95); }
        .btn { padding: 12px; background: rgba(255,215,0,0.2); border: 1px solid gold; color: gold; border-radius: 12px; width: 45%; font-weight: bold; cursor: pointer; }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; padding: 30px; }
        .plus { position: absolute; color: white; font-size: 30px; font-weight: bold; animation: up 0.6s forwards; pointer-events: none; }
        @keyframes up { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>
    <div class="row"><div class="btn" onclick="showT()">üèÜ –¢–û–ü</div><div class="btn" onclick="showR()">üë• –î–†–£–ó–¨–Ø</div></div>
    <div><div id="score">0</div><div id="status" style="opacity:0.6">–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>
    <div class="coin" id="coin">üî•</div>
    <div class="row"><div class="btn" onclick="showS()">üõí –ú–ê–ì–ê–ó–ò–ù</div><div class="btn" onclick="buyA()">‚öôÔ∏è –ú–ê–ô–ù–ï–†</div></div>

    <div id="modal">
        <h2 id="mt" style="color:gold"></h2><br><div id="ml" style="color:white"></div><br>
        <div class="btn" style="width:100%" onclick="closeM()">–ó–ê–ö–†–´–¢–¨</div>
    </div>

    <script>
        let tg = window.Telegram.WebApp; tg.expand();
        let id = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 12345;
        let score = 0, mult = 1, auto = 0;

        function draw() {
            document.getElementById('score').innerText = Math.floor(score);
            document.getElementById('status').innerText = `–ö–ª–∏–∫: +${mult} | –ú–∞–π–Ω–∏–Ω–≥: ${auto}/—Å`;
        }

        fetch('/u/' + id).then(r => r.json()).then(d => {
            score = d.score; mult = d.mult; auto = d.auto; draw();
        });

        setInterval(() => { if(auto > 0) { score += auto; draw(); if(Math.random() > 0.8) save(); } }, 1000);

        document.getElementById('coin').onclick = (e) => {
            score += mult; draw();
            let p = document.createElement('div'); p.className = 'plus'; p.innerText = '+' + mult;
            p.style.left = e.pageX + 'px'; p.style.top = e.pageY + 'px';
            document.body.appendChild(p); setTimeout(() => p.remove(), 600);
            if(score % 5 === 0) save();
        };

        function save() {
            fetch('/s', { method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({id: id, score: Math.floor(score), mult: mult, auto: auto})
            });
        }

        function showS() { let c = mult * 200; openM("üõí –ú–ê–ì–ê–ó–ò–ù", `–£–ª—É—á—à–∏—Ç—å –∫–ª–∏–∫ –¥–æ +${mult+1}<br>–¶–µ–Ω–∞: ${c} ü™ô<br><br><div class="btn" style="width:100%" onclick="buyM(${c})">–ö–£–ü–ò–¢–¨</div>`); }
        function buyM(c) { if(score >= c) { score -= c; mult++; save(); draw(); closeM(); } else { alert("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!"); } }
        function buyA() { let c = (auto + 1) * 500; if(score >= c) { score -= c; auto++; save(); draw(); alert("–ú–∞–π–Ω–µ—Ä +1/—Å!"); } else { alert("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!"); } }
        function showT() { fetch('/top').then(r => r.json()).then(d => { openM("üèÜ –¢–û–ü-10", d.map((l, i) => `${i+1}. ID ${l.id}: ${l.s}`).join('<br>')); }); }
        function showR() { openM("üë• –î–†–£–ó–¨–Ø", `–¢–≤–æ–π ID: ${id}<br>–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –ø–æ —Å—Å—ã–ª–∫–µ –±–æ—Ç–∞!`); }
        function openM(t, h) { document.getElementById('mt').innerText = t; document.getElementById('ml').innerHTML = h; document.getElementById('modal').style.display = 'block'; }
        function closeM() { document.getElementById('modal').style.display = 'none'; }
    </script>
</body>
</html>
