<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org"></script>
    <style>
        body { background: #000; color: gold; text-align: center; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; justify-content: space-between; margin: 0; overflow: hidden; }
        .row { display: flex; justify-content: space-around; padding: 10px; }
        #score { font-size: 50px; font-weight: bold; }
        .coin { width: 220px; height: 220px; background: orange; border-radius: 50%; border: 8px solid gold; font-size: 80px; display: flex; justify-content: center; align-items: center; margin: auto; box-shadow: 0 0 20px orange; cursor: pointer; }
        .btn { padding: 12px; background: #222; border: 1px solid gold; color: gold; border-radius: 10px; width: 45%; font-size: 14px; cursor: pointer; }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; padding: 20px; }
    </style>
</head>
<body>
    <div class="row"><div class="btn" onclick="showT()">–¢–û–ü</div><div class="btn" onclick="showR()">–î–†–£–ó–¨–Ø</div></div>
    <div><div id="score">0</div><div id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>
    <div class="coin" id="coin">üî•</div>
    <div class="row"><div class="btn" onclick="showS()">–ú–ê–ì–ê–ó–ò–ù</div><div class="btn" onclick="buyA()">‚öôÔ∏è –ú–ê–ô–ù–ï–†</div></div>

    <div id="modal">
        <h2 id="mt" style="color:gold;"></h2><br><div id="ml" style="color:white;"></div><br>
        <div class="btn" style="width:100%" onclick="closeM()">–ó–ê–ö–†–´–¢–¨</div>
    </div>

    <script>
        let tg = window.Telegram.WebApp; tg.expand();
        let id = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 12345;
        let score = 0, mult = 1, auto = 0;

        function draw() {
            document.getElementById('score').innerText = Math.floor(score);
            document.getElementById('status').innerText = `–ö–ª–∏–∫: +${mult} | –ê–≤—Ç–æ: ${auto}/—Å`;
        }

        fetch('/u/' + id).then(r => r.json()).then(d => {
            score = d.score; mult = d.mult; auto = d.auto; draw();
        }).catch(() => draw());

        setInterval(() => { if(auto > 0) { score += auto; draw(); if(Math.random() > 0.8) save(); } }, 1000);

        document.getElementById('coin').onclick = () => {
            score += mult; draw();
            if(score % 10 === 0) save();
        };

        function save() {
            fetch('/s', { 
                method: 'POST', 
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({id: id, score: Math.floor(score), mult: mult, auto: auto}) 
            });
        }

        function showS() { let c = mult * 200; openM("–ú–ê–ì–ê–ó–ò–ù", `–ö–ª–∏–∫ +1 –∑–∞ ${c}<br><br><div class="btn" style="width:100%" onclick="buyM(${c})">–ö–£–ü–ò–¢–¨</div>`); }
        function buyM(c) { if(score >= c) { score -= c; mult++; save(); draw(); closeM(); } }
        function buyA() { let c = (auto + 1) * 500; if(score >= c) { score -= c; auto++; save(); draw(); } }
        function showT() { fetch('/top').then(r => r.json()).then(d => { document.getElementById('ml').innerHTML = d.map(l => `${l.id}: <b>${l.s}</b>`).join('<br>'); openM("üèÜ –¢–û–ü-10", ""); }); }
        function showR() { openM("–î–†–£–ó–¨–Ø", `–¢–≤–æ–π ID: ${id}<br>https://t.me{id}`); }
        function openM(t, h) { document.getElementById('mt').innerText = t; if(h) document.getElementById('ml').innerHTML = h; document.getElementById('modal').style.display = 'block'; }
        function closeM() { document.getElementById('modal').style.display = 'none'; }
    </script>
</body>
</html>
