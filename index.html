<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #000; color: #fff; text-align: center; font-family: sans-serif; margin: 0; padding: 0; }
        .header { display: flex; padding: 10px; gap: 10px; background: #111; }
        .btn { flex: 1; padding: 12px; background: #222; border: 1px solid #ffd700; color: #ffd700; border-radius: 8px; font-weight: bold; cursor: pointer; }
        #score { font-size: 40px; color: #ffd700; margin: 20px 0; }
        .coin { width: 200px; height: 200px; background: orange; border-radius: 50%; margin: 20px auto; display: flex; align-items: center; justify-content: center; font-size: 80px; border: 5px solid #ffd700; cursor: pointer; }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; padding: 20px; box-sizing: border-box; }
        .progress { width: 80%; height: 10px; background: #222; margin: 10px auto; border-radius: 5px; overflow: hidden; }
        .fill { height: 100%; background: #ffd700; width: 100%; }
    </style>
</head>
<body>
    <div class="header">
        <button class="btn" onclick="showTop()">üèÜ –¢–û–ü</button>
        <button class="btn" onclick="showShop()">üõí –ú–ê–ì–ê–ó–ò–ù</button>
    </div>

    <div id="score">0</div>
    <div id="coin" class="coin">ü•ö</div>
    
    <div style="font-size: 14px;">‚ö° <span id="e-text">2500/2500</span> | ‚õèÔ∏è <span id="a-text">0</span>/s</div>
    <div class="progress"><div id="e-fill" class="fill"></div></div>

    <div id="modal">
        <h2 id="m-title" style="color:#ffd700"></h2>
        <div id="m-body" style="text-align: left;"></div>
        <button class="btn" style="width:100%; margin-top:20px;" onclick="document.getElementById('modal').style.display='none'">–ù–ê–ó–ê–î</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        const APP_URL = "https://my-tap-bot.onrender.com";
        let uid = tg.initDataUnsafe?.user?.id || 12345;
        let score = 0, mult = 1, auto = 0, energy = 2500, maxE = 2500;

        async function load() {
            let r = await fetch(`${APP_URL}/get_user?id=${uid}`);
            let d = await r.json();
            score = d.score; mult = d.mult; auto = d.auto; energy = d.energy; maxE = d.max_energy;
            updateUI();
        }

        function updateUI() {
            document.getElementById('score').innerText = Math.floor(score).toLocaleString();
            document.getElementById('e-text').innerText = `${Math.floor(energy)}/${maxE}`;
            document.getElementById('e-fill').style.width = (energy/maxE*100) + "%";
            document.getElementById('a-text').innerText = auto;
        }

        document.getElementById('coin').onclick = () => {
            if(energy >= mult) { score += mult; energy -= mult; updateUI(); }
        };

        async function showTop() {
            let r = await fetch(`${APP_URL}/get_top`);
            let d = await r.json();
            let h = d.map((u, i) => `<div style="padding:10px; border-bottom:1px solid #222;">${i+1}. ${u.username} - ${u.balance}</div>`).join('');
            document.getElementById('m-title').innerText = "üèÜ –õ–ò–î–ï–†–´";
            document.getElementById('m-body').innerHTML = h;
            document.getElementById('modal').style.display = 'block';
        }

        function showShop() {
            let h = `
                <div style="padding:15px; border:1px solid #ffd700; margin-bottom:10px; border-radius:10px; display:flex; justify-content:space-between;">
                    <span>‚õèÔ∏è –ú–∞–π–Ω–µ—Ä (+1/—Å)</span>
                    <button class="btn" style="flex:none; width:80px;" onclick="buyM()">–ö–£–ü–ò–¢–¨</button>
                </div>
            `;
            document.getElementById('m-title').innerText = "üõí –ú–ê–ì–ê–ó–ò–ù";
            document.getElementById('m-body').innerHTML = h;
            document.getElementById('modal').style.display = 'block';
        }

        function buyM() {
            let cost = (auto + 1) * 1000;
            if(score >= cost) { score -= cost; auto += 1; updateUI(); } else { tg.showAlert("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!"); }
        }

        setInterval(() => { if(auto > 0) { score += auto; updateUI(); } }, 1000);
        setInterval(() => { fetch(`${APP_URL}/s`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({id:uid, score:score, energy:energy})}); }, 5000);
        load();
    </script>
</body>
</html>
